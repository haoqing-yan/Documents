
## 什么是交易

渠道 -> ESB -> 核心 \ 支付系统 -> 仓库

全局流水号
交易流水号

- ESB

  转发
  组合

- 核心

  核心流水号
  序号
  存于批量中

- 缓存

## 日切

日期切换，更换系统记账的时间；对当天的系统业务进行集中处理，处理完毕后，系统从当前工作日切换到下一工作日，日切过程中交易可以照常提交并正确处理返回。

- 准点日切

 日初(Begin Of Day) ---> 日切(Cut Off) ---> 日终批量(End Of Day)


![](https://upload-images.jianshu.io/upload_images/11448329-1ad1dcba57e087df.jpg)

- 双余额机制

将余额分为当前余额和上次更新余额
```
分户处理：
按照交易的日期分为次日，前日处理
表字段增加以下

| 当前余额 | 上次更新日期 | 上日余额 | 发生交易时 |
| balance | last_date | last_balance | date |

```

- 双表机制 （双表又分两种：临时表为分户临时表或是流水临时表）


- 主要解决的时间结算问题

- T + 1账目
